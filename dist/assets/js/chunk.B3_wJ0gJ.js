var Ne=Object.defineProperty;var Ee=(d,a,s)=>a in d?Ne(d,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[a]=s;var M=(d,a,s)=>Ee(d,typeof a!="symbol"?a+"":a,s);import{r as b,a8 as A,c as y,bP as Ae,w as Q}from"./chunk.y8tVLCZ-.js";import{P as z,Q as qe,R as ke,U as xe,V as E}from"../index-CueJPN_h.js";import{i as Le}from"./chunk.DlQNAQKj.js";const F=(d,a,s,n={})=>({success:d,data:a,error:s,metadata:n}),$e={timeout:3e4,retryAttempts:3,enableCaching:!0,cacheTimeout:3e5};class ze{constructor(a={}){M(this,"cache",new Map);M(this,"config");this.config={...$e,...a}}async invokeCommand(a,s,n){const{timeout:h=this.config.timeout,retries:g=this.config.retryAttempts,cache:R=this.config.enableCaching,cacheKey:l}=n||{};if(R&&l){const c=this.getFromCache(l);if(c)return c}const w=crypto.randomUUID(),v=Date.now();try{console.log(`ğŸš€ [API] Invoking command: ${a}`,{args:s,requestId:w});const c=new Promise((_,S)=>{setTimeout(()=>S(new Error("Request timeout")),h)}),u=this.executeWithRetry(a,s,g),f=await Promise.race([u,c]),i=Date.now()-v;console.log(`âœ… [API] Command ${a} completed in ${i}ms`);const m=F(!0,f,void 0,{request_id:w,processing_time_ms:i,cache_hit:!1});return R&&l&&this.setCache(l,m),m}catch(c){const u=Date.now()-v;console.error(`âŒ [API] Command ${a} failed after ${u}ms:`,c);let f;return c instanceof Error?f=z(c,{command:a,args:s},w):f=z(qe.API_SERVER_ERROR,{command:a,args:s,originalError:c},w),F(!1,null,f,{request_id:w,processing_time_ms:u,cache_hit:!1})}}async executeWithRetry(a,s,n=0){let h;for(let g=0;g<=n;g++)try{return await Le(a,s)}catch(R){if(h=R,g===n)break;const l=Math.min(1e3*Math.pow(2,g),5e3);console.log(`ğŸ”„ [API] Retrying command ${a} in ${l}ms (attempt ${g+1}/${n})`),await new Promise(w=>setTimeout(w,l))}throw h}getFromCache(a){const s=this.cache.get(a);return s?Date.now()-s.timestamp>this.config.cacheTimeout?(this.cache.delete(a),null):{...s.data,metadata:{...s.data.metadata,cache_hit:!0}}:null}setCache(a,s){this.cache.set(a,{data:s,timestamp:Date.now(),expiry:Date.now()+this.config.cacheTimeout})}clearCache(a){if(a){const s=new RegExp(a);for(const n of this.cache.keys())s.test(n)&&this.cache.delete(n)}else this.cache.clear()}async getDraws(a={}){const s=`draws:${JSON.stringify(a)}`;return this.invokeCommand("get_super_lotto_draws",a,{cacheKey:s,cache:!0})}async getDrawById(a){return this.invokeCommand("get_super_lotto_draw_by_id",{id:a},{cacheKey:`draw:${a}`,cache:!0})}async importDraws(a){return this.clearCache("draws:"),this.invokeCommand("import_super_lotto_draws",{draws:a},{cache:!1})}async analyzeHotNumbers(a){const s=`hot_numbers:${JSON.stringify(a)}`;return this.invokeCommand("analyze_hot_numbers",a,{cacheKey:s,cache:!0})}async analyzeColdNumbers(a){const s=`cold_numbers:${JSON.stringify(a)}`;return this.invokeCommand("analyze_cold_numbers",a,{cacheKey:s,cache:!0})}async analyzePatterns(a){const s=`patterns:${JSON.stringify(a)}`;return this.invokeCommand("get_pattern_analysis",a,{cacheKey:s,cache:!0})}async generatePrediction(a){return this.invokeCommand("generate_prediction",a,{cache:!1})}async getPredictions(a={}){const s=`predictions:${JSON.stringify(a)}`;return this.invokeCommand("get_predictions",a,{cacheKey:s,cache:!0})}async validatePrediction(a){return this.invokeCommand("validate_prediction",{prediction_id:a},{cache:!1})}async getPredictionById(a){return this.invokeCommand("get_prediction_by_id",{id:a},{cacheKey:`prediction:${a}`,cache:!0})}async generateBatchPredictions(a){return this.invokeCommand("generate_all_predictions",{request:a},{timeout:6e4,cache:!1})}async getPredictionComparison(a,s){const n=`comparison:${a}:${s||90}`;return this.invokeCommand("get_prediction_comparison",{drawNumber:a,days:s},{cacheKey:n,cache:!0})}async getUnifiedTableData(a={}){const s=`unified_table:${JSON.stringify(a)}`;return this.invokeCommand("get_unified_table_data",a,{cacheKey:s,cache:!0})}async exportData(a){return this.invokeCommand("export_table_data",{exportRequest:a},{timeout:6e4,cache:!1})}async downloadExport(a){try{const s=await this.invokeCommand("download_export_file",{filename:a});if(s.success&&s.data){const n=new Blob([s.data]),h=URL.createObjectURL(n),g=document.createElement("a");g.href=h,g.download=a,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(h)}else throw new Error(s.error?.message||"Download failed")}catch(s){throw z(s,{filename:a}),s}}async getAvailableAlgorithms(){return this.invokeCommand("get_available_algorithms",{},{cacheKey:"algorithms",cache:!0})}async getAlgorithmConfig(a){const s=`algorithm_config:${a}`;return this.invokeCommand("get_algorithm_config",{algorithm_id:a},{cacheKey:s,cache:!0})}async validateSuperLottoNumbers(a,s){const n=[];a.length!==5&&n.push("å‰åŒºå·ç æ•°é‡å¿…é¡»ä¸º5ä¸ª"),new Set(a).size!==a.length&&n.push("å‰åŒºå·ç ä¸èƒ½é‡å¤");for(const h of a)(h<1||h>35)&&n.push("å‰åŒºå·ç å¿…é¡»åœ¨1-35èŒƒå›´å†…");return(s<1||s>12)&&n.push("ååŒºå·ç å¿…é¡»åœ¨1-12èŒƒå›´å†…"),F(!0,{valid:n.length===0,errors:n})}async healthCheck(){return this.invokeCommand("health_check",{},{timeout:5e3,cache:!1})}}const p=new ze;function Oe(){const d=b(!1),a=b(null),s=b(0),n=A({pendingRequests:0,totalRequests:0,successfulRequests:0,failedRequests:0}),h=y(()=>navigator.onLine),g=y(()=>n.pendingRequests>0),R=y(()=>n.totalRequests===0?0:n.successfulRequests/n.totalRequests*100),l=async(c,u)=>{const{showLoading:f=!0,showError:i=!0,retryOnError:m=!0}=u||{};f&&(d.value=!0),n.pendingRequests++,n.totalRequests++;try{const _=await c();return s.value=Date.now(),_.success&&_.data?(n.successfulRequests++,_.data):(n.failedRequests++,_.error&&i&&(a.value=_.error),null)}catch(_){n.failedRequests++;const S=z(_);return a.value=S,m&&S.recoverable?(console.log("ğŸ”„ Retrying request due to recoverable error..."),l(c,{...u,retryOnError:!1})):null}finally{n.pendingRequests--,f&&n.pendingRequests===0&&(d.value=!1)}};return{isLoading:d,error:a,lastRequestTime:s,requestState:n,isOnline:h,hasPendingRequests:g,successRate:R,executeRequest:l,clearError:()=>{a.value=null},resetStats:()=>{n.pendingRequests=0,n.totalRequests=0,n.successfulRequests=0,n.failedRequests=0},getDraws:c=>l(()=>p.getDraws(c)),getDrawById:c=>l(()=>p.getDrawById(c)),importDraws:c=>l(()=>p.importDraws(c)),analyzeHotNumbers:c=>l(()=>p.analyzeHotNumbers(c)),analyzeColdNumbers:c=>l(()=>p.analyzeColdNumbers(c)),analyzePatterns:c=>l(()=>p.analyzePatterns(c)),generatePrediction:c=>l(()=>p.generatePrediction(c)),getPredictions:c=>l(()=>p.getPredictions(c)),validatePrediction:c=>l(()=>p.validatePrediction(c)),generateBatchPredictions:c=>l(()=>p.generateBatchPredictions(c)),getUnifiedTableData:c=>l(()=>p.getUnifiedTableData(c)),exportData:c=>l(()=>p.exportData(c)),validateSuperLottoNumbers:(c,u)=>l(()=>p.validateSuperLottoNumbers(c,u)),healthCheck:()=>l(()=>p.healthCheck())}}const Te=ke(d=>p.generateBatchPredictions(d));console.log("ğŸ”— [Super Lotto API] Enhanced API client initialized with error handling");const Ie={enableAutoRefresh:!1,autoRefreshInterval:3e5,maxCacheSize:1e3,enablePersistence:!0,debugMode:!1},Ue=Ae("superLotto",()=>{const d=Oe();xe();const a=A({...Ie}),s=A({loading:!1,loading_text:void 0,progress:void 0,cancellable:!1}),n=A({has_error:!1,error_message:void 0,error_code:void 0,retry_count:0,can_retry:!1}),h=b([]),g=b(0),R=b([]),l=b([]),w=b([]),v=b([]),c=b([]),u=A({selected_items:[],selected_ids:[],last_selected:void 0,selection_mode:"single"}),f=A({active_filters:[],saved_filters:[],current_preset:void 0}),i=A({page:1,limit:100,total:0,has_next:!1,has_prev:!1}),m=A({query:"",active_search:!1,search_results:[],search_suggestions:[]}),_=new Map,S=(e,t,r=3e5)=>{if(_.set(e,{data:t,timestamp:Date.now(),ttl:r}),_.size>a.maxCacheSize){const o=Array.from(_.keys())[0];_.delete(o)}},x=e=>{const t=_.get(e);return t?Date.now()-t.timestamp>t.ttl?(_.delete(e),null):t.data:null},k=e=>{if(e){const t=new RegExp(e);for(const r of _.keys())t.test(r)&&_.delete(r)}else _.clear()},K=y(()=>s.loading),X=y(()=>n.has_error),Y=y(()=>n.error_message),Z=y(()=>n.can_retry&&n.retry_count<3),ee=y(()=>h.value.length>0),te=y(()=>v.value.length>0),ae=y(()=>R.value.length>0||l.value.length>0||w.value.length>0),L=y(()=>{let e=[...h.value];if(m.query&&(e=e.filter(t=>t.draw_number.toString().includes(m.query)||t.front_numbers.some(r=>r.toString().includes(m.query))||t.back_numbers.some(r=>r.toString().includes(m.query)))),f.active_filters.forEach(t=>{t.date_range&&(e=e.filter(r=>{const o=new Date(r.draw_date),N=new Date(t.date_range.start_date),q=new Date(t.date_range.end_date);return o>=N&&o<=q}))}),f.active_filters.some(t=>t.algorithm_ids)){const t=f.active_filters.find(r=>r.algorithm_ids);t?.algorithm_ids&&(e=e.filter(r=>v.value.some(o=>o.front_numbers[0]===r.front_numbers[0]&&t.algorithm_ids.includes(o.algorithm_id))))}return e}),re=y(()=>{const e=(i.page-1)*i.limit,t=e+i.limit;return L.value.slice(e,t)}),T=y(()=>Math.ceil(L.value.length/i.limit)),U=y(()=>v.value.filter(e=>e.is_validated)),se=y(()=>{const e=U.value;return e.length===0?0:e.reduce((r,o)=>r+(o.accuracy||0),0)/e.length}),ne=y(()=>v.value.length===0?null:v.value.reduce((e,t)=>t.confidence_score>e.confidence_score?t:e)),oe=y(()=>{const e=new Map;return v.value.forEach(t=>{e.has(t.algorithm_id)||e.set(t.algorithm_id,{algorithm_id:t.algorithm_id,algorithm_name:t.algorithm,count:0,total_confidence:0,average_confidence:0,max_confidence:0,validated_count:0,average_accuracy:0});const r=e.get(t.algorithm_id);r.count++,r.total_confidence+=t.confidence_score,r.max_confidence=Math.max(r.max_confidence,t.confidence_score),r.average_confidence=r.total_confidence/r.count,t.is_validated&&t.accuracy&&(r.validated_count++,r.average_accuracy=(r.average_accuracy*(r.validated_count-1)+t.accuracy)/r.validated_count)}),Array.from(e.values())}),O=(e,t,r,o)=>{s.loading=e,s.loading_text=t,s.progress=r,s.cancellable=o||!1},P=async(e,t)=>{O(!0,t);try{return await e()}finally{O(!1)}},ce=e=>{n.has_error=!0,n.error_message=e.message,n.error_code=e.code,n.can_retry=e.recoverable},C=()=>{n.has_error=!1,n.error_message=void 0,n.error_code=void 0,n.retry_count=0,n.can_retry=!1},D=()=>{n.retry_count++},J=async(e={})=>{const t=`draws:${JSON.stringify(e)}`,r=x(t);return r?(h.value=r.draws,g.value=r.total,r):P(async()=>{C();try{const o=await d.getDraws(e);return o&&(h.value=o.draws,g.value=o.total,i.limit=e.limit||100,i.page=Math.floor((e.offset||0)/i.limit)+1,i.total=o.total,i.has_next=i.page*i.limit<o.total,i.has_prev=i.page>1,S(t,o)),o}catch(o){throw D(),o}},"åŠ è½½å¼€å¥–æ•°æ®...")},ie=async(e={})=>P(async()=>{C();try{const t=await d.getPredictions(e);return t&&(v.value=t.predictions),t}catch(t){throw D(),t}},"åŠ è½½é¢„æµ‹æ•°æ®..."),le=async e=>{const t=`hot_numbers:${JSON.stringify(e)}`,r=x(t);return r?(R.value=r,r):P(async()=>{C();try{const o=await d.analyzeHotNumbers(e);return o&&(R.value=o,S(t,o)),o}catch(o){throw D(),o}},"åˆ†æçƒ­å·...")},ue=async e=>{const t=`cold_numbers:${JSON.stringify(e)}`,r=x(t);return r?(l.value=r,r):P(async()=>{C();try{const o=await d.analyzeColdNumbers(e);return o&&(l.value=o,S(t,o)),o}catch(o){throw D(),o}},"åˆ†æå†·å·...")},de=async e=>{const t=`patterns:${JSON.stringify(e)}`,r=x(t);return r?(w.value=r,r):P(async()=>{C();try{const o=await d.analyzePatterns(e);return o&&(w.value=o,S(t,o)),o}catch(o){throw D(),o}},"åˆ†ææ¨¡å¼...")},he=async e=>P(async()=>{C();try{const t=await d.generatePrediction(e);return t&&v.value.unshift(t),t}catch(t){throw D(),t}},"ç”Ÿæˆé¢„æµ‹..."),ge=async e=>P(async()=>{C();try{const t=await d.generateBatchPredictions(e);return t&&v.value.unshift(...t.predictions),t}catch(t){throw D(),t}},"æ‰¹é‡ç”Ÿæˆé¢„æµ‹..."),fe=(e,t="single")=>{if(u.selection_mode=t,u.last_selected=e,t==="single")u.selected_items=[e],u.selected_ids=[e.id.toString()];else{const r=e.id.toString(),o=u.selected_ids.indexOf(r);o>-1?(u.selected_ids.splice(o,1),u.selected_items=u.selected_items.filter(N=>N.id!==e.id)):(u.selected_ids.push(r),u.selected_items.push(e))}},G=()=>{u.selected_items=[],u.selected_ids=[],u.last_selected=void 0},me=()=>{u.selected_items=[...L.value],u.selected_ids=L.value.map(e=>e.id.toString())},_e=e=>{f.active_filters.push(e),k()},ye=e=>{f.active_filters.splice(e,1),k()},H=()=>{f.active_filters=[],f.current_preset=void 0,k()},ve=e=>{m.query=e,m.active_search=e.length>0},j=()=>{m.query="",m.active_search=!1,m.search_results=[]},I=e=>{i.page=Math.max(1,Math.min(e,T.value))},pe=()=>{i.has_next&&I(i.page+1)},we=()=>{i.has_prev&&I(i.page-1)},Re=e=>{i.limit=e,i.page=1},Se=(e,t)=>{const r=[];e.length!==5&&r.push("å‰åŒºå·ç æ•°é‡å¿…é¡»ä¸º5ä¸ª"),new Set(e).size!==e.length&&r.push("å‰åŒºå·ç ä¸èƒ½é‡å¤");for(const o of e)(o<E.FRONT_NUMBER_RANGE.min||o>E.FRONT_NUMBER_RANGE.max)&&r.push(`å‰åŒºå·ç å¿…é¡»åœ¨${E.FRONT_NUMBER_RANGE.min}-${E.FRONT_NUMBER_RANGE.max}èŒƒå›´å†…`);return(t<E.BACK_NUMBER_RANGE.min||t>E.BACK_NUMBER_RANGE.max)&&r.push(`ååŒºå·ç å¿…é¡»åœ¨${E.BACK_NUMBER_RANGE.min}-${E.BACK_NUMBER_RANGE.max}èŒƒå›´å†…`),{valid:r.length===0,errors:r}},B=(e,t="short")=>{const r=typeof e=="string"?new Date(e):e;return t==="short"?r.toLocaleDateString("zh-CN"):r.toLocaleString("zh-CN")},be=e=>{if(e.length===0)return null;const t={totalDraws:e.length,dateRange:{earliest:B(e[e.length-1].draw_date),latest:B(e[0].draw_date)},redNumberFrequency:new Map,blueNumberFrequency:new Map,averageJackpot:0,totalJackpot:0};let r=0,o=0;return e.forEach(N=>{N.front_numbers.forEach(q=>{t.redNumberFrequency.set(q,(t.redNumberFrequency.get(q)||0)+1)}),N.back_numbers.forEach(q=>{t.blueNumberFrequency.set(q,(t.blueNumberFrequency.get(q)||0)+1)}),N.prize_pool&&(r+=N.prize_pool,o++)}),t.averageJackpot=o>0?r/o:0,t.totalJackpot=r,t},Ce=()=>{h.value=[],g.value=0,R.value=[],l.value=[],w.value=[],v.value=[],c.value=[],C(),G(),H(),j(),k(),i.page=1,i.limit=100,i.total=0,i.has_next=!1,i.has_prev=!1},V=()=>{if(!a.enablePersistence)return;const e={selectionState:u.selected_ids,filterState:f.active_filters,searchState:m.query,pagination:{page:i.page,limit:i.limit}};localStorage.setItem("superLottoStore",JSON.stringify(e))},Pe=()=>{if(a.enablePersistence)try{const e=localStorage.getItem("superLottoStore");if(e){const t=JSON.parse(e);t.selectionState&&(u.selected_ids=t.selectionState),t.filterState&&(f.active_filters=t.filterState),t.searchState&&(m.query=t.searchState),t.pagination&&(i.page=t.pagination.page||1,i.limit=t.pagination.limit||100)}}catch(e){console.warn("Failed to load saved state:",e)}};let $=null;const De=()=>{a.enableAutoRefresh&&(W(),$=setInterval(async()=>{if(!K.value)try{await J({limit:i.limit})}catch(e){console.warn("Auto-refresh failed:",e)}},a.autoRefreshInterval))},W=()=>{$&&(clearInterval($),$=null)};return Q(()=>[u.selected_ids,f.active_filters,m.query,i.page,i.limit],V,{deep:!0}),Q(()=>[h.value.length,v.value.length],()=>{a.debugMode&&console.log("Data changed, clearing cache"),k()}),{config:a,loadingState:s,errorState:n,draws:h,totalDraws:g,hotNumbers:R,coldNumbers:l,patterns:w,predictions:v,algorithms:c,selectionState:u,filterState:f,searchState:m,pagination:i,isLoading:K,hasError:X,errorMessage:Y,canRetry:Z,isDataLoaded:ee,hasPredictions:te,hasAnalysisData:ae,filteredDraws:L,paginatedDraws:re,totalPages:T,validatedPredictions:U,averagePredictionAccuracy:se,bestPrediction:ne,algorithmStats:oe,setLoading:O,withLoading:P,setError:ce,clearError:C,incrementRetryCount:D,fetchDraws:J,fetchPredictions:ie,analyzeHotNumbers:le,analyzeColdNumbers:ue,analyzePatterns:de,generatePrediction:he,generateBatchPredictions:ge,selectDraw:fe,clearSelection:G,selectAll:me,addFilter:_e,removeFilter:ye,clearFilters:H,search:ve,clearSearch:j,setPage:I,nextPage:pe,prevPage:we,setLimit:Re,validateDrawNumbers:Se,formatDrawDate:B,calculateDrawStatistics:be,setCache:S,getCache:x,clearCache:k,startAutoRefresh:De,stopAutoRefresh:W,resetStore:Ce,saveState:V,loadState:Pe}});export{Te as g,Ue as u};
