var De=Object.defineProperty;var Oe=(d,a,n)=>a in d?De(d,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):d[a]=n;var M=(d,a,n)=>Oe(d,typeof a!="symbol"?a+"":a,n);import{r as L,a8 as T,c as y,bP as Ue,w as G}from"./chunk.Dy20xR8u.js";import{i as Te}from"./chunk.DlQNAQKj.js";import{P as C,Q as Pe,R as Ae,U as Ne}from"../index-Bf4lreNa.js";const be={timeout:3e4,retryAttempts:3,enableCaching:!0,cacheTimeout:3e5};class Ie{constructor(a={}){M(this,"config");M(this,"cache",new Map);this.config={...be,...a}}async invokeCommand(a,n,s){const{timeout:h=this.config.timeout,retries:_=this.config.retryAttempts,cache:S=this.config.enableCaching,cacheKey:l}=s||{};if(S&&l){const c=this.getFromCache(l);if(c)return c}const R=crypto.randomUUID(),v=Date.now();try{console.log(`üöÄ [API] Invoking command: ${a}`,{args:n,requestId:R});const c=new Promise((m,E)=>{setTimeout(()=>E(new Error("Request timeout")),h)}),u=this.executeWithRetry(a,n,_),g=await Promise.race([u,c]),i=Date.now()-v;console.log(`‚úÖ [API] Command ${a} completed in ${i}ms`);const f=createApiResponse(!0,g,void 0,{request_id:R,processing_time_ms:i,cache_hit:!1});return S&&l&&this.setCache(l,f),f}catch(c){const u=Date.now()-v;console.error(`‚ùå [API] Command ${a} failed after ${u}ms:`,c);let g;return c instanceof Error?g=C(c,{command:a,args:n},R):g=C(Pe.API_SERVER_ERROR,{command:a,args:n,originalError:c},R),createApiResponse(!1,void 0,g,{request_id:R,processing_time_ms:u,cache_hit:!1})}}async executeWithRetry(a,n,s=0){let h;for(let _=0;_<=s;_++)try{return await Te(a,n)}catch(S){if(h=S,_===s)break;const l=Math.min(1e3*Math.pow(2,_),5e3);console.log(`üîÑ [API] Retrying command ${a} in ${l}ms (attempt ${_+1}/${s})`),await new Promise(R=>setTimeout(R,l))}throw h}getFromCache(a){const n=this.cache.get(a);return n?Date.now()-n.timestamp>this.config.cacheTimeout?(this.cache.delete(a),null):{...n.data,metadata:{...n.data.metadata,cache_hit:!0}}:null}setCache(a,n){this.cache.set(a,{data:n,timestamp:Date.now()})}clearCache(a){if(a){const n=new RegExp(a);for(const s of this.cache.keys())n.test(s)&&this.cache.delete(s)}else this.cache.clear()}async getDraws(a={}){const n=`draws:${JSON.stringify(a)}`;return this.invokeCommand("get_super_lotto_draws",a,{cacheKey:n,cache:!0})}async getDrawById(a){return this.invokeCommand("get_super_lotto_draw_by_id",{id:a},{cacheKey:`draw:${a}`,cache:!0})}async importDraws(a){return this.clearCache("draws:"),this.invokeCommand("import_super_lotto_draws",{draws:a},{cache:!1})}async analyzeHotNumbers(a){const n=`hot_numbers:${JSON.stringify(a)}`;return this.invokeCommand("analyze_hot_numbers",a,{cacheKey:n,cache:!0})}async analyzeColdNumbers(a){const n=`cold_numbers:${JSON.stringify(a)}`;return this.invokeCommand("analyze_cold_numbers",a,{cacheKey:n,cache:!0})}async analyzePatterns(a){const n=`patterns:${JSON.stringify(a)}`;return this.invokeCommand("get_pattern_analysis",a,{cacheKey:n,cache:!0})}async generatePrediction(a){return this.invokeCommand("generate_prediction",a,{cache:!1})}async getPredictions(a={}){const n=`predictions:${JSON.stringify(a)}`;return this.invokeCommand("get_predictions",a,{cacheKey:n,cache:!0})}async validatePrediction(a){return this.invokeCommand("validate_prediction",{prediction_id:a},{cache:!1})}async getPredictionById(a){return this.invokeCommand("get_prediction_by_id",{id:a},{cacheKey:`prediction:${a}`,cache:!0})}async generateBatchPredictions(a){return this.invokeCommand("generate_all_predictions",{request:a},{timeout:6e4,cache:!1})}async getPredictionComparison(a,n){const s=`comparison:${a}:${n||90}`;return this.invokeCommand("get_prediction_comparison",{drawNumber:a,days:n},{cacheKey:s,cache:!0})}async getUnifiedTableData(a={}){const n=`unified_table:${JSON.stringify(a)}`;return this.invokeCommand("get_unified_table_data",a,{cacheKey:n,cache:!0})}async exportData(a){return this.invokeCommand("export_table_data",{exportRequest:a},{timeout:6e4,cache:!1})}async downloadExport(a){try{const n=await this.invokeCommand("download_export_file",{filename:a});if(n.success&&n.data){const s=new Blob([n.data]),h=URL.createObjectURL(s),_=document.createElement("a");_.href=h,_.download=a,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(h)}else throw new Error(n.error?.message||"Download failed")}catch(n){throw C(n,{filename:a}),n}}async getAvailableAlgorithms(){return this.invokeCommand("get_available_algorithms",{},{cacheKey:"algorithms",cache:!0})}async getAlgorithmConfig(a){const n=`algorithm_config:${a}`;return this.invokeCommand("get_algorithm_config",{algorithm_id:a},{cacheKey:n,cache:!0})}async validateSuperLottoNumbers(a,n){const s=[];a.length!==VALIDATION_RULES.SUPER_LOTTO.RED_NUMBERS.count&&s.push(`ÂâçÂå∫Âè∑Á†ÅÊï∞ÈáèÂøÖÈ°ª‰∏∫${VALIDATION_RULES.SUPER_LOTTO.RED_NUMBERS.count}‰∏™`),new Set(a).size!==a.length&&s.push("ÂâçÂå∫Âè∑Á†Å‰∏çËÉΩÈáçÂ§ç");for(const h of a)(h<VALIDATION_RULES.SUPER_LOTTO.RED_NUMBERS.range[0]||h>VALIDATION_RULES.SUPER_LOTTO.RED_NUMBERS.range[1])&&s.push(`ÂâçÂå∫Âè∑Á†ÅÂøÖÈ°ªÂú®${VALIDATION_RULES.SUPER_LOTTO.RED_NUMBERS.range[0]}-${VALIDATION_RULES.SUPER_LOTTO.RED_NUMBERS.range[1]}ËåÉÂõ¥ÂÜÖ`);return(n<VALIDATION_RULES.SUPER_LOTTO.BLUE_NUMBER.range[0]||n>VALIDATION_RULES.SUPER_LOTTO.BLUE_NUMBER.range[1])&&s.push(`ÂêéÂå∫Âè∑Á†ÅÂøÖÈ°ªÂú®${VALIDATION_RULES.SUPER_LOTTO.BLUE_NUMBER.range[0]}-${VALIDATION_RULES.SUPER_LOTTO.BLUE_NUMBER.range[1]}ËåÉÂõ¥ÂÜÖ`),createApiResponse(!0,{valid:s.length===0,errors:s})}async healthCheck(){return this.invokeCommand("health_check",{},{timeout:5e3,cache:!1})}}const p=new Ie;function Ce(){const d=L(!1),a=L(null),n=L(0),s=T({pendingRequests:0,totalRequests:0,successfulRequests:0,failedRequests:0}),h=y(()=>navigator.onLine),_=y(()=>s.pendingRequests>0),S=y(()=>s.totalRequests===0?0:s.successfulRequests/s.totalRequests*100),l=async(c,u)=>{const{showLoading:g=!0,showError:i=!0,retryOnError:f=!0}=u||{};g&&(d.value=!0),s.pendingRequests++,s.totalRequests++;try{const m=await c();return n.value=Date.now(),m.success&&m.data?(s.successfulRequests++,m.data):(s.failedRequests++,m.error&&i&&(a.value=m.error),null)}catch(m){s.failedRequests++;const E=C(m);return a.value=E,f&&E.recoverable?(console.log("üîÑ Retrying request due to recoverable error..."),l(c,{...u,retryOnError:!1})):null}finally{s.pendingRequests--,g&&s.pendingRequests===0&&(d.value=!1)}};return{isLoading:d,error:a,lastRequestTime:n,requestState:s,isOnline:h,hasPendingRequests:_,successRate:S,executeRequest:l,clearError:()=>{a.value=null},resetStats:()=>{s.pendingRequests=0,s.totalRequests=0,s.successfulRequests=0,s.failedRequests=0},getDraws:c=>l(()=>p.getDraws(c)),getDrawById:c=>l(()=>p.getDrawById(c)),importDraws:c=>l(()=>p.importDraws(c)),analyzeHotNumbers:c=>l(()=>p.analyzeHotNumbers(c)),analyzeColdNumbers:c=>l(()=>p.analyzeColdNumbers(c)),analyzePatterns:c=>l(()=>p.analyzePatterns(c)),generatePrediction:c=>l(()=>p.generatePrediction(c)),getPredictions:c=>l(()=>p.getPredictions(c)),validatePrediction:c=>l(()=>p.validatePrediction(c)),generateBatchPredictions:c=>l(()=>p.generateBatchPredictions(c)),getUnifiedTableData:c=>l(()=>p.getUnifiedTableData(c)),exportData:c=>l(()=>p.exportData(c)),validateSuperLottoNumbers:(c,u)=>l(()=>p.validateSuperLottoNumbers(c,u)),healthCheck:()=>l(()=>p.healthCheck())}}const xe=Ae((d,a)=>p.getPredictionComparison(d,a));console.log("üîó [Super Lotto API] Enhanced API client initialized with error handling");const qe={enableAutoRefresh:!1,autoRefreshInterval:3e5,maxCacheSize:1e3,enablePersistence:!0,debugMode:!1},ze=Ue("superLotto",()=>{const d=Ce();Ne();const a=T({...qe}),n=T({loading:!1,loading_text:void 0,progress:void 0,cancellable:!1}),s=T({has_error:!1,error_message:void 0,error_code:void 0,retry_count:0,can_retry:!1}),h=L([]),_=L(0),S=L([]),l=L([]),R=L([]),v=L([]),c=L([]),u=T({selected_items:[],selected_ids:[],last_selected:void 0,selection_mode:"single"}),g=T({active_filters:[],saved_filters:[],current_preset:void 0}),i=T({page:1,limit:100,total:0,has_next:!1,has_prev:!1}),f=T({query:"",active_search:!1,search_results:[],search_suggestions:[]}),m=new Map,E=(e,t,r=3e5)=>{if(m.set(e,{data:t,timestamp:Date.now(),ttl:r}),m.size>a.maxCacheSize){const o=Array.from(m.keys())[0];m.delete(o)}},A=e=>{const t=m.get(e);return t?Date.now()-t.timestamp>t.ttl?(m.delete(e),null):t.data:null},P=e=>{if(e){const t=new RegExp(e);for(const r of m.keys())t.test(r)&&m.delete(r)}else m.clear()},$=y(()=>n.loading),W=y(()=>s.has_error),Q=y(()=>s.error_message),X=y(()=>s.can_retry&&s.retry_count<3),Y=y(()=>h.value.length>0),Z=y(()=>v.value.length>0),ee=y(()=>S.value.length>0||l.value.length>0||R.value.length>0),N=y(()=>{let e=[...h.value];if(f.query&&(e=e.filter(t=>t.draw_number.toString().includes(f.query)||t.red_numbers.some(r=>r.toString().includes(f.query))||t.blue_number.toString().includes(f.query))),g.active_filters.forEach(t=>{t.date_range&&(e=e.filter(r=>{const o=new Date(r.draw_date),D=new Date(t.date_range.start_date),I=new Date(t.date_range.end_date);return o>=D&&o<=I}))}),g.active_filters.some(t=>t.algorithm_ids)){const t=g.active_filters.find(r=>r.algorithm_ids);t?.algorithm_ids&&(e=e.filter(r=>v.value.some(o=>o.draw_number===r.draw_number&&t.algorithm_ids.includes(o.algorithm_id))))}return e}),te=y(()=>{const e=(i.page-1)*i.limit,t=e+i.limit;return N.value.slice(e,t)}),x=y(()=>Math.ceil(N.value.length/i.limit)),z=y(()=>v.value.filter(e=>e.is_validated)),ae=y(()=>{const e=z.value;return e.length===0?0:e.reduce((r,o)=>r+(o.accuracy||0),0)/e.length}),re=y(()=>v.value.length===0?null:v.value.reduce((e,t)=>t.confidence_score>e.confidence_score?t:e)),ne=y(()=>{const e=new Map;return v.value.forEach(t=>{e.has(t.algorithm_id)||e.set(t.algorithm_id,{algorithm_id:t.algorithm_id,algorithm_name:t.algorithm_name,count:0,total_confidence:0,average_confidence:0,max_confidence:0,validated_count:0,average_accuracy:0});const r=e.get(t.algorithm_id);r.count++,r.total_confidence+=t.confidence_score,r.max_confidence=Math.max(r.max_confidence,t.confidence_score),r.average_confidence=r.total_confidence/r.count,t.is_validated&&t.accuracy&&(r.validated_count++,r.average_accuracy=(r.average_accuracy*(r.validated_count-1)+t.accuracy)/r.validated_count)}),Array.from(e.values())}),q=(e,t,r,o)=>{n.loading=e,n.loading_text=t,n.progress=r,n.cancellable=o||!1},O=async(e,t)=>{q(!0,t);try{return await e()}finally{q(!1)}},se=e=>{s.has_error=!0,s.error_message=e.message,s.error_code=e.code,s.can_retry=e.recoverable},w=()=>{s.has_error=!1,s.error_message=void 0,s.error_code=void 0,s.retry_count=0,s.can_retry=!1},U=()=>{s.retry_count++},V=async(e={})=>{const t=`draws:${JSON.stringify(e)}`,r=A(t);return r?(h.value=r.draws,_.value=r.total,r):O(async()=>{w();try{const o=await d.getDraws(e);return o&&(h.value=o.draws,_.value=o.total,i.limit=e.limit||100,i.page=Math.floor((e.offset||0)/i.limit)+1,i.total=o.total,i.has_next=i.page*i.limit<o.total,i.has_prev=i.page>1,E(t,o)),o}catch(o){throw U(),o}},"Âä†ËΩΩÂºÄÂ•ñÊï∞ÊçÆ...")},oe=async(e={})=>O(async()=>{w();try{const t=await d.getPredictions(e);return t&&(v.value=t.predictions),t}catch(t){throw U(),t}},"Âä†ËΩΩÈ¢ÑÊµãÊï∞ÊçÆ..."),ce=async e=>{const t=`hot_numbers:${JSON.stringify(e)}`,r=A(t);return r?(S.value=r,r):O(async()=>{w();try{const o=await d.analyzeHotNumbers(e);return o&&(S.value=o,E(t,o)),o}catch(o){throw U(),o}},"ÂàÜÊûêÁÉ≠Âè∑...")},ie=async e=>{const t=`cold_numbers:${JSON.stringify(e)}`,r=A(t);return r?(l.value=r,r):O(async()=>{w();try{const o=await d.analyzeColdNumbers(e);return o&&(l.value=o,E(t,o)),o}catch(o){throw U(),o}},"ÂàÜÊûêÂÜ∑Âè∑...")},le=async e=>{const t=`patterns:${JSON.stringify(e)}`,r=A(t);return r?(R.value=r,r):O(async()=>{w();try{const o=await d.analyzePatterns(e);return o&&(R.value=o,E(t,o)),o}catch(o){throw U(),o}},"ÂàÜÊûêÊ®°Âºè...")},ue=async e=>O(async()=>{w();try{const t=await d.generatePrediction(e);return t&&v.value.unshift(t),t}catch(t){throw U(),t}},"ÁîüÊàêÈ¢ÑÊµã..."),de=async e=>O(async()=>{w();try{const t=await d.generateBatchPredictions(e);return t&&v.value.unshift(...t.predictions),t}catch(t){throw U(),t}},"ÊâπÈáèÁîüÊàêÈ¢ÑÊµã..."),he=(e,t="single")=>{if(u.selection_mode=t,u.last_selected=e,t==="single")u.selected_items=[e],u.selected_ids=[e.id.toString()];else{const r=e.id.toString(),o=u.selected_ids.indexOf(r);o>-1?(u.selected_ids.splice(o,1),u.selected_items=u.selected_items.filter(D=>D.id!==e.id)):(u.selected_ids.push(r),u.selected_items.push(e))}},F=()=>{u.selected_items=[],u.selected_ids=[],u.last_selected=void 0},_e=()=>{u.selected_items=[...N.value],u.selected_ids=N.value.map(e=>e.id.toString())},ge=e=>{g.active_filters.push(e),P()},fe=e=>{g.active_filters.splice(e,1),P()},J=()=>{g.active_filters=[],g.current_preset=void 0,P()},me=e=>{f.query=e,f.active_search=e.length>0},K=()=>{f.query="",f.active_search=!1,f.search_results=[]},k=e=>{i.page=Math.max(1,Math.min(e,x.value))},ye=()=>{i.has_next&&k(i.page+1)},ve=()=>{i.has_prev&&k(i.page-1)},pe=e=>{i.limit=e,i.page=1},Re=(e,t)=>{const r=[];e.length!==VALIDATION_RULES.SUPER_LOTTO.RED_NUMBERS.count&&r.push(`ÂâçÂå∫Âè∑Á†ÅÊï∞ÈáèÂøÖÈ°ª‰∏∫${VALIDATION_RULES.SUPER_LOTTO.RED_NUMBERS.count}‰∏™`),new Set(e).size!==e.length&&r.push("ÂâçÂå∫Âè∑Á†Å‰∏çËÉΩÈáçÂ§ç");for(const o of e)(o<VALIDATION_RULES.SUPER_LOTTO.RED_NUMBERS.range[0]||o>VALIDATION_RULES.SUPER_LOTTO.RED_NUMBERS.range[1])&&r.push(`ÂâçÂå∫Âè∑Á†ÅÂøÖÈ°ªÂú®${VALIDATION_RULES.SUPER_LOTTO.RED_NUMBERS.range[0]}-${VALIDATION_RULES.SUPER_LOTTO.RED_NUMBERS.range[1]}ËåÉÂõ¥ÂÜÖ`);return(t<VALIDATION_RULES.SUPER_LOTTO.BLUE_NUMBER.range[0]||t>VALIDATION_RULES.SUPER_LOTTO.BLUE_NUMBER.range[1])&&r.push(`ÂêéÂå∫Âè∑Á†ÅÂøÖÈ°ªÂú®${VALIDATION_RULES.SUPER_LOTTO.BLUE_NUMBER.range[0]}-${VALIDATION_RULES.SUPER_LOTTO.BLUE_NUMBER.range[1]}ËåÉÂõ¥ÂÜÖ`),{valid:r.length===0,errors:r}},B=(e,t="short")=>{const r=typeof e=="string"?new Date(e):e;return t==="short"?r.toLocaleDateString("zh-CN"):r.toLocaleString("zh-CN")},Se=e=>{if(e.length===0)return null;const t={totalDraws:e.length,dateRange:{earliest:B(e[e.length-1].draw_date),latest:B(e[0].draw_date)},redNumberFrequency:new Map,blueNumberFrequency:new Map,averageJackpot:0,totalJackpot:0};let r=0,o=0;return e.forEach(D=>{D.red_numbers.forEach(I=>{t.redNumberFrequency.set(I,(t.redNumberFrequency.get(I)||0)+1)}),t.blueNumberFrequency.set(D.blue_number,(t.blueNumberFrequency.get(D.blue_number)||0)+1),D.jackpot_amount&&(r+=D.jackpot_amount,o++)}),t.averageJackpot=o>0?r/o:0,t.totalJackpot=r,t},Ee=()=>{h.value=[],_.value=0,S.value=[],l.value=[],R.value=[],v.value=[],c.value=[],w(),F(),J(),K(),P(),i.page=1,i.limit=100,i.total=0,i.has_next=!1,i.has_prev=!1},H=()=>{if(!a.enablePersistence)return;const e={selectionState:u.selected_ids,filterState:g.active_filters,searchState:f.query,pagination:{page:i.page,limit:i.limit}};localStorage.setItem("superLottoStore",JSON.stringify(e))},Le=()=>{if(a.enablePersistence)try{const e=localStorage.getItem("superLottoStore");if(e){const t=JSON.parse(e);t.selectionState&&(u.selected_ids=t.selectionState),t.filterState&&(g.active_filters=t.filterState),t.searchState&&(f.query=t.searchState),t.pagination&&(i.page=t.pagination.page||1,i.limit=t.pagination.limit||100)}}catch(e){console.warn("Failed to load saved state:",e)}};let b=null;const we=()=>{a.enableAutoRefresh&&(j(),b=setInterval(async()=>{if(!$.value)try{await V({limit:i.limit,offset:(i.page-1)*i.limit})}catch(e){console.warn("Auto-refresh failed:",e)}},a.autoRefreshInterval))},j=()=>{b&&(clearInterval(b),b=null)};return G(()=>[u.selected_ids,g.active_filters,f.query,i.page,i.limit],H,{deep:!0}),G(()=>[h.value.length,v.value.length],()=>{a.debugMode&&console.log("Data changed, clearing cache"),P()}),{config:a,loadingState:n,errorState:s,draws:h,totalDraws:_,hotNumbers:S,coldNumbers:l,patterns:R,predictions:v,algorithms:c,selectionState:u,filterState:g,searchState:f,pagination:i,isLoading:$,hasError:W,errorMessage:Q,canRetry:X,isDataLoaded:Y,hasPredictions:Z,hasAnalysisData:ee,filteredDraws:N,paginatedDraws:te,totalPages:x,validatedPredictions:z,averagePredictionAccuracy:ae,bestPrediction:re,algorithmStats:ne,setLoading:q,withLoading:O,setError:se,clearError:w,incrementRetryCount:U,fetchDraws:V,fetchPredictions:oe,analyzeHotNumbers:ce,analyzeColdNumbers:ie,analyzePatterns:le,generatePrediction:ue,generateBatchPredictions:de,selectDraw:he,clearSelection:F,selectAll:_e,addFilter:ge,removeFilter:fe,clearFilters:J,search:me,clearSearch:K,setPage:k,nextPage:ye,prevPage:ve,setLimit:pe,validateDrawNumbers:Re,formatDrawDate:B,calculateDrawStatistics:Se,setCache:E,getCache:A,clearCache:P,startAutoRefresh:we,stopAutoRefresh:j,resetStore:Ee,saveState:H,loadState:Le}});console.log("üéØ [Super Lotto Store] Enhanced Pinia store with advanced patterns loaded");export{xe as g,ze as u};
